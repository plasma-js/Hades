!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("yup")):"function"==typeof define&&define.amd?define(["yup"],b):a.index=b(a.yup)}(this,function(b){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function i(a){if(d(this,i),!a)throw new Error("The second param 'fields' is obrigatory!");this.data=[],this.fields=a,this.model=function(a){var b=[];return Array.isArray(a)?(b.array=null,b.of=r(a)):(b.object=null,b.shape=r(a)),b}(this.fields),this.schema=this.mapSchema(this.model)}function f(){return p.apply(this,arguments)}function j(){d(this,j)}function k(a){d(this,k),this.collections=new c,this.events=[],this.history=[],this.getters=[],a&&"function"==typeof a&&a.bind(this)}var l,m,p,q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a=function(a,b,c){return b&&g(a.prototype,b),c&&g(a,c),a},r=function a(b){return"object"!==(void 0===b?"undefined":q(b))&&"array"!=typeof b||("object"===(void 0===b?"undefined":q(b))?Object:Array).keys(b).forEach(function(c){if("object"===q(b[c])||"array"==typeof b[c]){var d=b[c],e=Array.isArray(d)?"array":"object",f="array"==e?"of":"shape";b[c]=[],b[c][e]=null,b[c][f]=a(d)}else b[c]=function(a){var b=[];return a.split("|").forEach(function(a){var c=a.split("(")[1]?a.split("(")[1].split(")")[0]:null;b[c?a.split("(")[0]:a]=c}),b}(b[c])}),b},n=(a(i,[{key:"runner",value:function(a){var c=this,d=b;return Object.keys(a).forEach(function(b){var e=a[b];d=d[b].call(c,e)}),d}},{key:"mapEntries",value:function(a){var b={};return Object.keys(a).forEach(function(c){b[c]=a[c]}),b}},{key:"mapSchema",value:(p=function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=b;return Object.keys(a).forEach(function(f){c?"shape"===c?(d===b&&(d={}),d[f]=mapSchema(a[f])):"of"===c&&(d=mapSchema(a[f])):"object"===f||"array"===f?d=null===a[f]?d[f].call(d):d[f].call(d,a[f]):"shape"===f||"of"===f?d=d[f].call(d,mapSchema(a[f],f)):null!==a[f]||(d=d[f].call(d))}),d},f.toString=function(){return p.toString()},f)},{key:"validate",value:(l=regeneratorRuntime.mark(function a(c){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.schema instanceof b)return a.next=3,this.schema.validate(c);a.next=6;break;case 3:a.sent,a.next=7;break;case 6:throw new Error("Unable to validate with a undefined model schema.");case 7:case"end":return a.stop();}},a,this)}),m=function(){var a=l.apply(this,arguments);return new Promise(function(b,c){return function d(f,e){try{var g=a[f](e),h=g.value}catch(a){return void c(a)}return g.done?void b(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}("next")})},function(){return m.apply(this,arguments)})}]),i),c=(a(j,[{key:"new",value:function(a,b){if(this[a])throw new Error("Collection '"+a+"' already exists!");this[a]=new n(b)}},{key:"remove",value:function(a){if(!this[a])throw new Error("Collection '"+a+"' not found!");this[a]=null,delete this[a]}}]),j);return a(k,[{key:"publish",value:function(a,b){var c=this,d=1<arguments.length&&void 0!==b?b:null,e=this.events[a];if(!e||!e.length)throw new Error("Event called before one handler definition.");e.forEach(function(a){a.bind(c,d)})}},{key:"subscribe",value:function(a,b){if(!a||"string"!=typeof a)throw new Error("The first param is empty or invalid.");if(this.events[a]||(this.events[a]=[]),!b||"function"!=typeof b)throw new Error("The second param is required and should be a function!");this.events[a].push(b)}}]),k});
