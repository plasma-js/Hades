!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("babel-polyfill"),require("yup")):"function"==typeof define&&define.amd?define(["babel-polyfill","yup"],t):(e=e||self).index=t(null,e.yup)}(this,function(e,i){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n,r,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void n(e)}u.done?t(l):Promise.resolve(l).then(r,o)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var l,o,c=function o(i){"object"!==a(i)&&"array"!=typeof i||("object"===a(i)?Object:Array).keys(i).forEach(function(e){if("object"===a(i[e])||"array"==typeof i[e]){var t=i[e],n=Array.isArray(t)?"array":"object",r="array"==n?"of":"shape";i[e]=[],i[e][n]=null,i[e][r]=o(t)}else i[e]=function(e){var n=[];return e.split("|").forEach(function(e){var t=e.split("(")[1]?e.split("(")[1].split(")")[0]:null;n[t?e.split("(")[0]:e]=t}),n}(i[e])});return i},s=(n(p,[{key:"runner",value:function(n){var r=this,o=i;return Object.keys(n).forEach(function(e){var t=n[e];o=o[e].call(r,t)}),o}},{key:"mapEntries",value:function(t){var n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}},{key:"mapSchema",value:function(t){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,o=i;return Object.keys(t).forEach(function(e){r?"shape"===r?(o===i&&(o={}),o[e]=n.mapSchema(t[e])):"of"===r&&(o=n.mapSchema(t[e])):"object"===e||"array"===e?o=null===t[e]?o[e].call(o):o[e].call(o,t[e]):"shape"===e||"of"===e?o=o[e].call(o,n.mapSchema(t[e],e)):null!==t[e]||(o=o[e].call(o))}),o}},{key:"validate",value:(l=regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.schema instanceof i)return n=this.schema.validate(t),e.abrupt("return",n);e.next=5;break;case 5:throw new Error("Unable to validate with a undefined model schema.");case 6:case"end":return e.stop()}},e,this)}),o=function(){var e=this,a=arguments;return new Promise(function(t,n){function r(e){u(i,t,n,r,o,"next",e)}function o(e){u(i,t,n,r,o,"throw",e)}var i=l.apply(e,a);r(void 0)})},function(){return o.apply(this,arguments)})}]),p),f=(n(y,[{key:"new",value:function(e,t){if(this[e])throw new Error("Collection '".concat(e,"' already exists!"));this[e]=new s(t)}},{key:"remove",value:function(e){if(!this[e])throw new Error("Collection '".concat(e,"' not found!"));this[e]=null,delete this[e]}}]),y);function h(e){t(this,h),this.collections=new f,this.events=[],this.history=[],this.getters=[],e&&"function"==typeof e&&e.bind(this)}function y(){t(this,y)}function p(e){if(t(this,p),!e)throw new Error("The second param 'fields' is obrigatory!");this.data=[],this.fields=e,this.model=function(e){var t=[];return Array.isArray(e)?(t.array=null,t.of=c(e)):(t.object=null,t.shape=c(e)),t}(this.fields),this.schema=this.mapSchema(this.model)}return n(h,[{key:"publish",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=this.events[e];if(!r||!r.length)throw new Error("Event called before one handler definition.");r.forEach(function(e){e.bind(t,n)})}},{key:"subscribe",value:function(e,t){if(!e||"string"!=typeof e)throw new Error("The first param is empty or invalid.");if(this.events[e]||(this.events[e]=[]),!t||"function"!=typeof t)throw new Error("The second param is required and should be a function!");this.events[e].push(t)}}]),h});
